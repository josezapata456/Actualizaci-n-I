<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>MONIFY - Transferir</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <main class="app">
    <header class="header">
      <div class="logo">M</div>
      <div class="brand"><h2>Transferir</h2><p>Enviar dinero</p></div>
    </header>

    <section class="card">
      <form id="transferForm" class="form">
        <label class="hint">Usuario destino</label>
        <input id="targetUser" class="input" type="text" required placeholder="Nombre de usuario" />
        
        <label class="hint">Monto a transferir</label>
        <input id="transferAmount" class="input" type="number" step="0.01" min="0.01" required />
        
        <div class="balance-info">
          <small>Saldo disponible: $<span id="currentBalance">0.00</span></small>
        </div>
        
        <div id="transferMsg" class="success" style="display:none"></div>
        <div id="transferErr" class="error" style="display:none"></div>

        <div class="row" style="margin-top:6px">
          <button class="btn btn-primary" type="submit" style="flex:1">Transferir</button>
          <a href="home.html" class="btn btn-ghost" style="flex:1">Cancelar</a>
        </div>
      </form>
    </section>
  </main>

  <script src="js/app.js"></script>
  <script>
    // Mostrar saldo actual
    document.addEventListener('DOMContentLoaded', function() {
        const user = MONIFY.getCurrentUser();
        if(user) {
            document.getElementById('currentBalance').textContent = Number(user.balance).toFixed(2);
        }
    });

    // Manejar transferencia
    document.getElementById("transferForm").addEventListener("submit", async function(e){
        e.preventDefault();
        const targetUser = document.getElementById("targetUser").value.trim();
        const amount = parseFloat(document.getElementById("transferAmount").value);
        const msg = document.getElementById("transferMsg");
        const err = document.getElementById("transferErr");
        
        msg.style.display = err.style.display = "none";

        // Mostrar loading
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = "Procesando...";
        submitBtn.disabled = true;

        try {
            console.log("üîÑ Iniciando transferencia...", {
                targetUser: targetUser,
                amount: amount
            });

            const result = await MONIFY.transfer(MONIFY.getCurrentUser().id, targetUser, amount);
            console.log("‚úÖ Transferencia exitosa:", result);
            
            msg.style.display = "block"; 
            msg.textContent = `Transferencia exitosa a ${result.target_user}. Nuevo saldo: $${Number(result.new_balance).toFixed(2)}`;
            
            setTimeout(() => window.location.href = "home.html", 2000);
        } catch(ex) {
            console.error("‚ùå Error en transferencia:", ex);
            err.style.display = "block"; 
            err.textContent = ex.message || "Error en la transferencia";
        } finally {
            // Restaurar bot√≥n
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    });
  </script>
</body>
</html>