<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>MONIFY - Depositar</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <main class="app">
    <header class="header">
      <div class="logo">M</div>
      <div class="brand"><h2>Depositar</h2><p>Agregar fondos</p></div>
    </header>

    <section class="card">
      <form id="depositForm" class="form">
        <label class="hint">Monto a depositar</label>
        <input id="depositAmount" class="input" type="number" step="0.01" min="0" required />
        <div id="depMsg" class="success" style="display:none"></div>
        <div id="depErr" class="error" style="display:none"></div>

        <div class="row" style="margin-top:6px">
          <button class="btn btn-primary" type="submit" style="flex:1">Depositar</button>
          <a href="home.html" class="btn btn-ghost" style="flex:1">Cancelar</a>
        </div>
      </form>
    </section>
  </main>

  <script src="js/app.js"></script>
  <script>
    const form = document.getElementById("depositForm");
    form.addEventListener("submit", async function(e){
      e.preventDefault();
      const v = parseFloat(document.getElementById("depositAmount").value);
      const msg = document.getElementById("depMsg"), err=document.getElementById("depErr");
      msg.style.display = err.style.display = "none";

      // Validaciones
      if(isNaN(v) || v <= 0){ err.style.display = 'block'; err.textContent = 'Ingrese un monto mayor que 0.'; return; }

      try{
        const user = MONIFY.getCurrentUser();
        if(!user) throw new Error("Sesión no iniciada");
        const newBal = await window.depositTo(user.username, v);
        msg.style.display = "block"; msg.textContent = 'Depósito realizado. Nuevo saldo: ' + newBal;
        setTimeout(()=> window.location.href = "home.html", 1200);
      }catch(ex){
        err.style.display="block"; err.textContent = (ex && ex.message) ? ex.message : "Error en depósito";
      }
    });
  </script>
</body>
</html>
